<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>looksmax.ai</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap');

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}

:root{
  --bg:#090909;--surface:#131313;--surface2:#1a1a1a;--surface3:#202020;
  --border:#242424;--border2:#2e2e2e;
  --accent:#c8f53f;--accent-dim:rgba(200,245,63,0.12);--accent-glow:rgba(200,245,63,0.25);
  --amber:#f5a623;--amber-dim:rgba(245,166,35,0.12);
  --red:#ff4d6d;--red-dim:rgba(255,77,109,0.12);
  --blue:#4d9fff;--blue-dim:rgba(77,159,255,0.12);
  --text:#efefef;--text2:#aaa;--text3:#666;
  --radius:20px;--radius-sm:12px;
}

html,body{height:100%;background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif}

.shell{
  min-height:100vh;display:flex;align-items:flex-start;justify-content:center;
  padding:40px 0 60px;
  background:#040404;
  background-image:
    radial-gradient(ellipse 55% 55% at 20% 35%,rgba(200,245,63,0.055) 0%,transparent 65%),
    radial-gradient(ellipse 45% 55% at 80% 65%,rgba(200,245,63,0.03) 0%,transparent 65%);
}
@media(max-width:640px){
  .shell{display:block;background:var(--bg);min-height:100dvh;padding:0}
  .frame{width:100%!important;max-width:100%!important;border-radius:0!important;border:none!important;box-shadow:none!important;height:auto!important;min-height:100dvh!important}
}

.frame{
  width:390px;height:auto;min-height:844px;border-radius:48px;
  border:1px solid #222;
  box-shadow:0 0 0 1px #161616,0 50px 100px rgba(0,0,0,.9),inset 0 1px 0 rgba(255,255,255,0.06);
  overflow:hidden;background:var(--bg);
  display:flex;flex-direction:column;position:relative;
}
.scroller{flex:1;overflow:visible;position:relative}

.screen{display:none;flex-direction:column;min-height:844px}
.screen.active{display:flex}

/* ════ SPLASH ════ */
#splash{align-items:center;justify-content:center;min-height:844px;position:relative;overflow:hidden}
.splash-bg{
  position:absolute;inset:0;
  background:radial-gradient(circle at 50% 45%,rgba(200,245,63,0.08) 0%,transparent 60%);
  animation:breathe 4s ease-in-out infinite;
}
@keyframes breathe{0%,100%{transform:scale(1);opacity:.6}50%{transform:scale(1.1);opacity:1}}
.splash-content{z-index:1;text-align:center;animation:riseIn .9s cubic-bezier(.22,1,.36,1) forwards}
@keyframes riseIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

.wordmark{font-family:'Syne',sans-serif;font-size:38px;font-weight:800;letter-spacing:-2px;line-height:1}
.wordmark .w1{background:linear-gradient(135deg,#d8ff4a,#a0d800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.wordmark .w2{color:#333;-webkit-text-fill-color:#333}
.splash-sub{color:var(--text3);font-size:12px;letter-spacing:2.5px;text-transform:uppercase;margin-top:12px}

.splash-cards{display:flex;flex-direction:column;gap:10px;margin:48px 0;align-items:center}
.splash-card{
  width:280px;display:flex;align-items:center;gap:13px;
  background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:14px 16px;
}
.sc-dot{width:8px;height:8px;border-radius:50%;background:var(--accent);flex-shrink:0;box-shadow:0 0 8px var(--accent-glow)}
.sc-text{font-size:13px;font-weight:500;color:var(--text2)}

.splash-cta{
  background:var(--accent);color:#000;font-family:'Syne',sans-serif;font-weight:800;font-size:16px;
  padding:19px 64px;border:none;border-radius:100px;cursor:pointer;letter-spacing:.2px;
  box-shadow:0 10px 30px rgba(200,245,63,0.3);transition:transform .15s,box-shadow .2s;
}
.splash-cta:hover{box-shadow:0 14px 40px rgba(200,245,63,0.45);transform:translateY(-2px)}
.splash-cta:active{transform:scale(.97)}

/* ════ HOME ════ */
#home{min-height:844px}
.home-head{padding:52px 22px 18px;display:flex;justify-content:space-between;align-items:flex-start}
.home-titles h1{font-family:'Syne',sans-serif;font-size:28px;font-weight:800;letter-spacing:-1.2px;line-height:1.15}
.home-titles h1 em{font-style:normal;color:var(--accent)}
.home-titles p{color:var(--text3);font-size:13px;margin-top:6px}
.streak-badge{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:8px 14px;text-align:center;flex-shrink:0;
}
.streak-badge .snum{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--accent)}
.streak-badge .slbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;display:block;margin-top:1px}

/* Mode selector */
.mode-selector{margin:0 22px 14px;display:flex;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:5px}
.mode-btn{
  flex:1;padding:10px 8px;border-radius:12px;border:none;background:transparent;
  color:var(--text3);font-family:'Syne',sans-serif;font-size:12px;font-weight:700;
  cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:6px;
}
.mode-btn.active{background:var(--accent-dim);color:var(--accent);border:1px solid rgba(200,245,63,0.2)}
.mode-btn svg{width:14px;height:14px}

.upload-zone{
  margin:4px 22px 0;border:1.5px dashed var(--border2);border-radius:24px;
  padding:28px 20px;text-align:center;cursor:pointer;background:var(--surface);
  transition:border-color .2s,background .2s;user-select:none;
}
.upload-zone:hover{border-color:#3a3a3a;background:#151515}
.upload-zone.drag-over,.upload-zone:active{border-color:var(--accent);background:var(--accent-dim)}
.uz-icon{
  width:56px;height:56px;background:var(--surface2);border-radius:16px;
  display:flex;align-items:center;justify-content:center;margin:0 auto 12px;
}
.uz-icon svg{width:24px;height:24px}
.upload-zone h3{font-family:'Syne',sans-serif;font-size:16px;font-weight:700}
.upload-zone p{color:var(--text3);font-size:12px;margin-top:4px}
.upload-zone .mode-hint{
  display:inline-block;margin-top:10px;padding:5px 12px;
  background:var(--accent-dim);color:var(--accent);border-radius:100px;font-size:11px;font-weight:600;
}

.divrow{display:flex;align-items:center;gap:12px;padding:10px 22px;color:var(--text3);font-size:11px;letter-spacing:1.5px;text-transform:uppercase}
.divrow::before,.divrow::after{content:'';flex:1;height:1px;background:var(--border)}

.quick-row{display:flex;gap:9px;padding:0 22px}
.quick-btn{
  flex:1;background:var(--surface);border:1px solid var(--border);border-radius:18px;
  padding:14px 12px;cursor:pointer;transition:background .2s,border-color .2s;
}
.quick-btn:hover{background:var(--surface2);border-color:var(--border2)}
.quick-btn:active{background:var(--surface3)}
.qb-icon{
  width:38px;height:38px;background:var(--surface2);border-radius:11px;
  display:flex;align-items:center;justify-content:center;margin-bottom:10px;
}
.qb-icon svg{width:18px;height:18px}
.quick-btn h4{font-family:'Syne',sans-serif;font-size:13px;font-weight:700}
.quick-btn p{color:var(--text3);font-size:11px;margin-top:2px}

.hist-section{padding:18px 22px 110px}
.hist-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:13px}
.hist-header h2{font-family:'Syne',sans-serif;font-size:16px;font-weight:700}
.hist-header button{background:none;border:none;color:var(--text3);font-size:12px;cursor:pointer;font-family:'DM Sans',sans-serif}
.hist-empty{
  background:var(--surface);border-radius:16px;padding:26px;
  text-align:center;color:var(--text3);font-size:13px;line-height:1.7;
}
.hist-list{display:flex;flex-direction:column;gap:9px}
.hist-item{
  display:flex;align-items:center;gap:13px;
  background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:13px;
  cursor:pointer;transition:background .2s;
}
.hist-item:hover{background:var(--surface2)}
.hist-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;flex-shrink:0}
.hist-info{flex:1;min-width:0}
.hist-info .hi-score{font-family:'Syne',sans-serif;font-size:18px;font-weight:800}
.hist-info .hi-label{font-size:12px;color:var(--text3);margin-top:1px}
.hist-info .hi-date{font-size:11px;color:var(--text3);margin-top:3px}
.hist-arrow{color:var(--text3)}
.hist-arrow svg{width:16px;height:16px}

/* Mode tag on hist items */
.hi-mode{
  display:inline-block;font-size:10px;font-weight:600;padding:2px 8px;border-radius:100px;margin-top:3px;
}
.hi-mode.face{background:var(--accent-dim);color:var(--accent)}
.hi-mode.body{background:var(--blue-dim);color:var(--blue)}
.hi-mode.full{background:rgba(200,245,63,0.08);color:var(--amber)}

/* ─── NAV ─── */
.nav{
  width:100%;background:rgba(9,9,9,0.97);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
  border-top:1px solid var(--border);
  display:flex;justify-content:space-around;align-items:center;
  padding:10px 0 22px;flex-shrink:0;
  position:sticky;bottom:0;z-index:50;
}
@media(max-width:640px){.nav{padding-bottom:env(safe-area-inset-bottom,20px)}}
.ni{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:4px 14px;color:var(--text3);transition:color .2s}
.ni svg{width:21px;height:21px}
.ni span{font-size:10px;font-weight:500;letter-spacing:.3px}
.ni.active{color:var(--accent)}
.ni.active svg{filter:drop-shadow(0 0 6px var(--accent-glow))}

/* ════ ANALYZING ════ */
#analyzing{align-items:center;justify-content:center;padding:40px 22px;gap:20px;min-height:844px}
.scan-avatar-wrap{position:relative}
.scan-avatar{width:150px;height:150px;border-radius:50%;object-fit:cover;border:3px solid var(--border2)}
.scan-ring{
  position:absolute;inset:-12px;border-radius:50%;
  border:2px solid transparent;
  background:linear-gradient(var(--bg),var(--bg)) padding-box,
    conic-gradient(var(--accent) var(--prog,0%),transparent var(--prog,0%)) border-box;
  animation:spin 2s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.scan-dots{position:absolute;inset:0;border-radius:50%;animation:pulse-ring 1.5s ease-in-out infinite}
@keyframes pulse-ring{0%,100%{box-shadow:0 0 0 0 var(--accent-glow)}50%{box-shadow:0 0 0 18px rgba(200,245,63,0)}}

/* Dual image scan for full body mode */
.scan-dual{display:flex;gap:10px;align-items:center}
.scan-dual .scan-avatar-wrap{transform:scale(0.75)}
.scan-dual-sep{color:var(--text3);font-size:12px;font-weight:600}

.scan-text{text-align:center}
.scan-text h2{font-family:'Syne',sans-serif;font-size:22px;font-weight:800}
.scan-text p{color:var(--text3);font-size:13px;margin-top:6px}
.scan-pct{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--accent);margin-top:4px}

.prog-track{width:100%;height:5px;background:var(--surface2);border-radius:100px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),#a0d800);border-radius:100px;width:0%;transition:width .5s ease}

.steps{width:100%;display:flex;flex-direction:column;gap:8px}
.step{
  display:flex;align-items:center;gap:11px;
  background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:12px 14px;
  opacity:.25;transition:opacity .5s,border-color .4s;
}
.step.done{opacity:1;border-color:var(--border2)}
.step-ic{width:30px;height:30px;background:var(--surface2);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.step-ic svg{width:14px;height:14px}
.step p{font-size:13px;font-weight:500;flex:1}
.step-ck{color:var(--accent);opacity:0;transition:opacity .3s;flex-shrink:0}
.step-ck svg{width:16px;height:16px}
.step.done .step-ck{opacity:1}

/* ════ RESULTS ════ */
#results{min-height:844px}
.res-hero{
  padding:46px 22px 20px;text-align:center;
  background:linear-gradient(180deg,#0f0f0f 0%,var(--bg) 100%);
  position:relative;
}
.res-avatar{
  width:88px;height:88px;border-radius:50%;object-fit:cover;
  border:3px solid var(--accent);box-shadow:0 0 32px var(--accent-glow);
  margin-bottom:16px;
}
.res-ring{
  position:relative;width:116px;height:116px;
  display:flex;align-items:center;justify-content:center;margin:0 auto 12px;
}
.res-ring svg{position:absolute;top:0;left:0;transform:rotate(-90deg)}
.res-num{font-family:'Syne',sans-serif;font-size:46px;font-weight:800;line-height:1;position:relative;z-index:1}
.res-label{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;margin-bottom:4px}
.res-sub{color:var(--text3);font-size:12px;letter-spacing:.5px}

/* Penalty banner */
.penalty-banner{
  margin:0 22px 12px;padding:12px 16px;
  background:var(--red-dim);border:1px solid rgba(255,77,109,0.25);border-radius:14px;
  display:flex;align-items:center;gap:10px;
}
.penalty-banner svg{width:18px;height:18px;color:var(--red);flex-shrink:0}
.penalty-banner p{font-size:12px;color:var(--red);line-height:1.4}
.penalty-banner strong{font-weight:700}

/* Score breakdown row */
.score-breakdown{
  margin:0 14px 12px;background:var(--surface);border:1px solid var(--border);border-radius:16px;
  display:flex;overflow:hidden;
}
.sbd-item{flex:1;padding:13px 10px;text-align:center;border-right:1px solid var(--border)}
.sbd-item:last-child{border-right:none}
.sbd-val{font-family:'Syne',sans-serif;font-size:20px;font-weight:800}
.sbd-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-top:2px}

.share-row{display:flex;gap:8px;padding:0 22px 14px}
.share-btn{
  flex:1;display:flex;align-items:center;justify-content:center;gap:7px;
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:13px 10px;cursor:pointer;font-size:12px;font-weight:600;color:var(--text2);
  transition:background .2s,border-color .2s;font-family:'DM Sans',sans-serif;
}
.share-btn:hover{background:var(--surface2);border-color:var(--border2)}
.share-btn:active{background:var(--surface3)}
.share-btn svg{width:16px;height:16px;flex-shrink:0}
.share-btn.primary{background:var(--accent-dim);border-color:rgba(200,245,63,0.25);color:var(--accent)}
.share-btn.primary:hover{background:rgba(200,245,63,0.18)}

.feedback-card{
  margin:0 14px 10px;background:var(--surface);border:1px solid var(--border);
  border-radius:20px;padding:18px;
}
.fc-head{display:flex;align-items:center;gap:10px;margin-bottom:13px}
.fc-head svg{width:18px;height:18px;color:var(--accent);flex-shrink:0}
.fc-head h3{font-family:'Syne',sans-serif;font-size:15px;font-weight:700}
.fc-text{font-size:13px;color:var(--text2);line-height:1.7;white-space:pre-wrap}
.fc-loading{display:flex;align-items:center;gap:9px;color:var(--text3);font-size:13px}
.fc-loading .dots span{animation:blink 1.2s infinite}
.fc-loading .dots span:nth-child(2){animation-delay:.2s}
.fc-loading .dots span:nth-child(3){animation-delay:.4s}
@keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}

/* Section headers */
.section-label{
  padding:0 18px 8px;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;
  color:var(--text3);letter-spacing:1.2px;text-transform:uppercase;
}

.metrics-grid{padding:0 14px;display:grid;grid-template-columns:1fr 1fr;gap:9px}
.mc{
  background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:15px;
  animation:fadeUp .5s ease backwards;
}
.mc:nth-child(1){animation-delay:.05s}.mc:nth-child(2){animation-delay:.1s}
.mc:nth-child(3){animation-delay:.15s}.mc:nth-child(4){animation-delay:.2s}
.mc:nth-child(5){animation-delay:.25s}.mc:nth-child(6){animation-delay:.3s}
.mc:nth-child(7){animation-delay:.35s}.mc:nth-child(8){animation-delay:.4s}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.mc-lbl{color:var(--text3);font-size:10px;letter-spacing:.8px;text-transform:uppercase;margin-bottom:7px;display:flex;align-items:center;gap:5px}
.mc-lbl .lbl-icon{width:14px;height:14px;opacity:.7}
.mc-val{font-family:'Syne',sans-serif;font-size:30px;font-weight:800;line-height:1;display:flex;align-items:baseline;gap:5px}
.mc-val .den{font-size:12px;color:var(--text3);font-weight:400}
.mc-badge{display:inline-block;font-size:10px;font-weight:600;padding:3px 9px;border-radius:100px;margin-top:6px}
.b-g{background:var(--accent-dim);color:var(--accent)}
.b-a{background:var(--amber-dim);color:var(--amber)}
.b-r{background:var(--red-dim);color:var(--red)}
.b-b{background:var(--blue-dim);color:var(--blue)}
.mc-bar{height:3px;background:var(--border2);border-radius:100px;margin-top:10px;overflow:hidden}
.mc-fill{height:100%;border-radius:100px;transition:width 1.2s cubic-bezier(.22,1,.36,1)}

/* Body fat visual indicator */
.mc.body-metric{border-color:rgba(77,159,255,0.15)}
.mc.body-metric .mc-lbl{color:var(--blue)}

.tips-wrap{padding:12px 14px 0}
.tips-head{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;margin-bottom:10px;padding:0 4px}
.tip{
  display:flex;gap:12px;align-items:flex-start;
  background:var(--surface);border:1px solid var(--border);border-radius:15px;
  padding:13px 14px;margin-bottom:8px;animation:fadeUp .5s ease backwards;
}
.tip:nth-child(2){animation-delay:.35s}.tip:nth-child(3){animation-delay:.4s}.tip:nth-child(4){animation-delay:.45s}
.tip-ic{width:34px;height:34px;background:var(--surface2);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.tip-ic svg{width:16px;height:16px}
.tip h4{font-size:13px;font-weight:600;margin-bottom:3px}
.tip p{font-size:12px;color:var(--text3);line-height:1.55}

.retry{
  margin:12px 14px 0;background:var(--surface);border:1px solid var(--border);
  border-radius:100px;padding:16px;width:calc(100% - 28px);
  font-family:'Syne',sans-serif;font-weight:700;font-size:14px;
  color:var(--text);cursor:pointer;
  display:flex;align-items:center;justify-content:center;gap:8px;
  transition:background .2s,border-color .2s;
}
.retry:hover{background:var(--surface2);border-color:var(--border2)}
.retry:active{background:var(--surface3)}
.retry svg{width:16px;height:16px}

/* ════ HISTORY SCREEN ════ */
#history{min-height:844px}
.hist-screen-head{padding:52px 22px 20px;display:flex;align-items:center;justify-content:space-between}
.hist-screen-head h1{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;letter-spacing:-1px}
.hist-clear{background:none;border:none;color:var(--text3);font-size:13px;cursor:pointer;font-family:'DM Sans',sans-serif}
.hist-full-list{padding:0 22px 110px;display:flex;flex-direction:column;gap:9px}
.hist-empty-state{
  margin:40px 22px;background:var(--surface);border-radius:20px;padding:40px;text-align:center;
}
.hist-empty-state p{color:var(--text3);font-size:14px;line-height:1.7;margin-top:12px}
.hist-empty-state svg{width:36px;height:36px;color:var(--text3)}

/* ════ TIPS SCREEN ════ */
#tipsscreen{min-height:844px}
.tips-screen-head{padding:52px 22px 22px}
.tips-screen-head h1{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;letter-spacing:-1px}
.tips-screen-head p{color:var(--text3);font-size:13px;margin-top:6px}
.tip-categories{padding:0 22px 110px;display:flex;flex-direction:column;gap:14px}
.tip-cat{background:var(--surface);border:1px solid var(--border);border-radius:20px;overflow:hidden}
.tip-cat-head{display:flex;align-items:center;gap:12px;padding:16px;cursor:pointer;border-bottom:1px solid var(--border)}
.tip-cat-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.tip-cat-icon svg{width:18px;height:18px}
.tip-cat-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:700}
.tip-cat-sub{font-size:12px;color:var(--text3);margin-top:2px}
.tip-cat-items{padding:4px 0}
.tip-cat-item{padding:13px 16px;display:flex;gap:10px;align-items:flex-start;border-bottom:1px solid var(--border)}
.tip-cat-item:last-child{border-bottom:none}
.ti-num{
  width:22px;height:22px;border-radius:50%;background:var(--accent-dim);
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:700;color:var(--accent);flex-shrink:0;margin-top:1px;
}
.ti-text h5{font-size:13px;font-weight:600;margin-bottom:2px}
.ti-text p{font-size:12px;color:var(--text3);line-height:1.5}

/* ════ PROFILE ════ */
#profile{min-height:844px}
.prof-head{padding:52px 22px 24px;text-align:center}
.prof-avatar-wrap{
  width:88px;height:88px;border-radius:50%;background:var(--surface2);
  border:2px solid var(--border2);margin:0 auto 14px;
  display:flex;align-items:center;justify-content:center;overflow:hidden;
}
.prof-avatar-wrap img{width:100%;height:100%;object-fit:cover;display:none}
.prof-avatar-wrap svg{width:36px;height:36px;color:var(--text3)}
.prof-name{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;letter-spacing:-.5px}
.prof-since{color:var(--text3);font-size:12px;margin-top:4px}
.prof-stats{display:flex;gap:1px;margin:0 22px 18px;background:var(--border);border-radius:18px;overflow:hidden}
.pstat{flex:1;background:var(--surface);padding:16px 12px;text-align:center}
.pstat .psn{font-family:'Syne',sans-serif;font-size:22px;font-weight:800}
.pstat .psl{font-size:11px;color:var(--text3);margin-top:3px}
.prof-section{padding:0 22px 14px}
.prof-section h3{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px;padding:0 2px}
.prof-row{
  display:flex;align-items:center;gap:13px;
  background:var(--surface);border:1px solid var(--border);border-radius:15px;
  padding:14px 16px;margin-bottom:8px;cursor:pointer;transition:background .2s;
}
.prof-row:hover{background:var(--surface2)}
.pr-icon{width:36px;height:36px;background:var(--surface2);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.pr-icon svg{width:16px;height:16px}
.pr-label{flex:1;font-size:14px;font-weight:500}
.pr-val{font-size:13px;color:var(--text3)}
.pr-arrow svg{width:14px;height:14px;color:var(--text3)}

/* MODAL */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);
  display:none;align-items:flex-end;justify-content:center;z-index:200;
}
.modal-overlay.open{display:flex}
.modal-sheet{
  background:var(--surface);border:1px solid var(--border);border-radius:28px 28px 0 0;
  width:100%;max-width:390px;padding:20px 22px 40px;animation:sheetUp .35s cubic-bezier(.22,1,.36,1);
}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet-handle{width:36px;height:4px;background:var(--border2);border-radius:100px;margin:0 auto 20px}
.sheet-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;margin-bottom:16px}
.share-option{
  display:flex;align-items:center;gap:14px;padding:14px 0;
  border-bottom:1px solid var(--border);cursor:pointer;transition:opacity .15s;
}
.share-option:last-child{border-bottom:none}
.share-option:active{opacity:.6}
.so-icon{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.so-icon svg{width:20px;height:20px}
.so-label{font-size:14px;font-weight:500}
.so-sub{font-size:12px;color:var(--text3);margin-top:1px}

/* TOAST */
.toast{
  position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);
  background:var(--surface);border:1px solid var(--border2);border-radius:100px;
  padding:11px 22px;font-size:13px;font-weight:500;
  white-space:nowrap;opacity:0;transition:opacity .3s,transform .3s;z-index:300;
  pointer-events:none;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

#fileInput,#cameraInput,#bodyFileInput{display:none}
</style>
</head>
<body>
<div class="shell">
<div class="frame">

<div class="toast" id="toast"></div>

<div class="modal-overlay" id="shareModal" onclick="closeModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Share Results</div>
    <div class="share-option" onclick="shareAction('image')">
      <div class="so-icon" style="background:var(--accent-dim)">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
      </div>
      <div><div class="so-label">Save as Image</div><div class="so-sub">Download your result card</div></div>
    </div>
    <div class="share-option" onclick="shareAction('copy')">
      <div class="so-icon" style="background:var(--surface2)">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--text2)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
      </div>
      <div><div class="so-label">Copy Result</div><div class="so-sub">Copy score to clipboard</div></div>
    </div>
    <div class="share-option" onclick="shareAction('native')">
      <div class="so-icon" style="background:var(--surface2)">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--text2)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
      </div>
      <div><div class="so-label">Share via...</div><div class="so-sub">Open system share sheet</div></div>
    </div>
  </div>
</div>

<div class="scroller" id="scroller">

<!-- ════ SPLASH ════ -->
<div class="screen active" id="splash">
  <div class="splash-bg"></div>
  <div class="splash-content">
    <div class="wordmark"><span class="w1">looksmax</span><span class="w2">.ai</span></div>
    <div class="splash-sub">AI-Powered Appearance Analysis</div>
    <div class="splash-cards">
      <div class="splash-card"><div class="sc-dot"></div><div class="sc-text">8 scored metrics + detailed AI feedback</div></div>
      <div class="splash-card"><div class="sc-dot"></div><div class="sc-text">Body composition affects your overall score</div></div>
      <div class="splash-card"><div class="sc-dot"></div><div class="sc-text">Personalized improvement roadmap</div></div>
    </div>
    <button class="splash-cta" onclick="goTo('home')">Get Started</button>
  </div>
</div>

<!-- ════ HOME ════ -->
<div class="screen" id="home">
  <div class="home-head">
    <div class="home-titles">
      <h1>Rate Your<br><em>Look</em></h1>
      <p>Choose analysis mode below</p>
    </div>
    <div class="streak-badge">
      <div class="snum" id="streakNum">0</div>
      <span class="slbl">Scans</span>
    </div>
  </div>

  <!-- Mode selector -->
  <div class="mode-selector">
    <button class="mode-btn active" id="modeFaceBtn" onclick="setMode('face')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="5"/><path d="M7 8a5 5 0 0 0 10 0"/></svg>
      Face Only
    </button>
    <button class="mode-btn" id="modeBodyBtn" onclick="setMode('body')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/><path d="M6 10h12l-1 7H7l-1-7z"/><path d="M9 17l-2 5M15 17l2 5"/></svg>
      Body + Face
    </button>
  </div>

  <div class="upload-zone" id="uploadZone" onclick="handleZoneClick()">
    <div class="uz-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
      </svg>
    </div>
    <h3 id="uzTitle">Upload Face Photo</h3>
    <p id="uzDesc">Clear, well-lit selfie • Facing forward</p>
    <div class="mode-hint" id="uzHint">Face Analysis</div>
  </div>
  <input type="file" id="fileInput" accept="image/*" onchange="handleFile(this,'face')">
  <input type="file" id="bodyFileInput" accept="image/*" onchange="handleFile(this,'body')">
  <input type="file" id="cameraInput" accept="image/*" capture="user" onchange="handleFile(this,'face')">

  <!-- Body mode upload prompt (shown in body mode after face is uploaded) -->
  <div id="bodyUploadZone" style="display:none;margin:8px 22px 0">
    <div class="upload-zone" onclick="document.getElementById('bodyFileInput').click()">
      <div class="uz-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/><path d="M6 10h12l-1 7H7l-1-7z"/><path d="M9 17l-2 5M15 17l2 5"/></svg>
      </div>
      <h3 style="color:var(--accent)">Add Body Photo</h3>
      <p>Full body shot for composition analysis</p>
      <div class="mode-hint" style="background:var(--blue-dim);color:var(--blue)">Step 2 / 2</div>
    </div>
  </div>

  <div class="divrow">or</div>

  <div class="quick-row">
    <div class="quick-btn" onclick="document.getElementById('cameraInput').click()">
      <div class="qb-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
        </svg>
      </div>
      <h4>Selfie</h4>
      <p>Use camera</p>
    </div>
    <div class="quick-btn" onclick="handleZoneClick()">
      <div class="qb-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
      </div>
      <h4>Gallery</h4>
      <p>Browse files</p>
    </div>
    <div class="quick-btn" onclick="goTo('tipsscreen')">
      <div class="qb-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
        </svg>
      </div>
      <h4>Tips</h4>
      <p>Improve</p>
    </div>
  </div>

  <div class="hist-section">
    <div class="hist-header">
      <h2>Recent Scans</h2>
      <button onclick="goTo('history')">See All</button>
    </div>
    <div id="homeHistList"><div class="hist-empty">No scans yet. Upload your first photo to get started.</div></div>
  </div>

  <nav class="nav">
    <div class="ni active" onclick="navTo('home',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span>Home</span>
    </div>
    <div class="ni" onclick="navTo('history',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      <span>History</span>
    </div>
    <div class="ni" onclick="navTo('tipsscreen',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      <span>Tips</span>
    </div>
    <div class="ni" onclick="navTo('profile',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span>Profile</span>
    </div>
  </nav>
</div>

<!-- ════ ANALYZING ════ -->
<div class="screen" id="analyzing">
  <div id="scanImgWrap" class="scan-avatar-wrap">
    <img id="scanImg" class="scan-avatar" src="" alt="">
    <div class="scan-ring"></div>
    <div class="scan-dots"></div>
  </div>
  <div class="scan-text">
    <h2 id="scanTitle">Analyzing Your Face</h2>
    <p id="scanStatus">Preparing analysis...</p>
    <div class="scan-pct" id="scanPct">0%</div>
  </div>
  <div class="prog-track" style="width:100%"><div class="prog-fill" id="progFill"></div></div>
  <div class="steps" id="analysisSteps">
    <!-- dynamically populated -->
  </div>
</div>

<!-- ════ RESULTS ════ -->
<div class="screen" id="results">
  <div class="res-hero">
    <img id="resAvatar" class="res-avatar" src="" alt="">
    <div class="res-ring">
      <svg width="116" height="116" viewBox="0 0 116 116">
        <circle cx="58" cy="58" r="50" fill="none" stroke="#1c1c1c" stroke-width="7"/>
        <circle id="resCircle" cx="58" cy="58" r="50" fill="none" stroke-width="7"
          stroke-linecap="round" stroke-dasharray="314.2" stroke-dashoffset="314.2"
          style="transition:stroke-dashoffset 1.8s cubic-bezier(.22,1,.36,1);stroke:var(--accent)"/>
      </svg>
      <div class="res-num" id="resNum">—</div>
    </div>
    <div class="res-label" id="resLabel">—</div>
    <div class="res-sub" id="resSub">out of 10</div>
  </div>

  <!-- Penalty banner (conditionally shown) -->
  <div class="penalty-banner" id="penaltyBanner" style="display:none">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
    <p id="penaltyText"></p>
  </div>

  <!-- Score breakdown (shown in body mode) -->
  <div class="score-breakdown" id="scoreBreakdown" style="display:none">
    <div class="sbd-item">
      <div class="sbd-val" id="sbdFace">—</div>
      <div class="sbd-lbl">Face</div>
    </div>
    <div class="sbd-item">
      <div class="sbd-val" id="sbdBody">—</div>
      <div class="sbd-lbl">Body</div>
    </div>
    <div class="sbd-item">
      <div class="sbd-val" id="sbdFinal">—</div>
      <div class="sbd-lbl">Final</div>
    </div>
  </div>

  <div class="share-row">
    <div class="share-btn primary" onclick="openModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
      Share
    </div>
    <div class="share-btn" onclick="shareAction('copy')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
      Copy
    </div>
    <div class="share-btn" onclick="goTo('home')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-3.51"/></svg>
      New Scan
    </div>
  </div>

  <div class="feedback-card">
    <div class="fc-head">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      <h3>AI Feedback</h3>
    </div>
    <div id="fcContent">
      <div class="fc-loading">
        <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        Generating detailed feedback<span class="dots"><span>.</span><span>.</span><span>.</span></span>
      </div>
    </div>
  </div>

  <div class="section-label" id="faceMetricsLabel">FACE METRICS</div>
  <div class="metrics-grid" id="metricsGrid"></div>

  <div class="section-label" id="bodyMetricsLabel" style="display:none;padding-top:12px">BODY METRICS</div>
  <div class="metrics-grid" id="bodyMetricsGrid" style="display:none"></div>

  <div class="tips-wrap" id="tipsWrap"><div class="tips-head">Improvement Tips</div></div>

  <button class="retry" onclick="goTo('home')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
    Analyze Another Photo
  </button>

  <nav class="nav" style="margin-top:12px">
    <div class="ni" onclick="navTo('home',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></div>
    <div class="ni active" onclick="navTo('history',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span>History</span></div>
    <div class="ni" onclick="navTo('tipsscreen',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg><span>Tips</span></div>
    <div class="ni" onclick="navTo('profile',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></div>
  </nav>
</div>

<!-- ════ HISTORY ════ -->
<div class="screen" id="history">
  <div class="hist-screen-head">
    <h1>All Scans</h1>
    <button class="hist-clear" onclick="clearHistory()">Clear All</button>
  </div>
  <div class="hist-full-list" id="fullHistList">
    <div class="hist-empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      <p>Your scan history will appear here.<br>Upload a photo to get started.</p>
    </div>
  </div>
  <nav class="nav" style="position:sticky;bottom:0">
    <div class="ni" onclick="navTo('home',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></div>
    <div class="ni active" onclick="navTo('history',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span>History</span></div>
    <div class="ni" onclick="navTo('tipsscreen',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg><span>Tips</span></div>
    <div class="ni" onclick="navTo('profile',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></div>
  </nav>
</div>

<!-- ════ TIPS SCREEN ════ -->
<div class="screen" id="tipsscreen">
  <div class="tips-screen-head">
    <h1>Improve Your<br><span style="color:var(--accent)">Look</span></h1>
    <p>Science-backed tips for each metric</p>
  </div>
  <div class="tip-categories">

    <div class="tip-cat">
      <div class="tip-cat-head">
        <div class="tip-cat-icon" style="background:var(--blue-dim)">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/><path d="M6 10h12l-1 7H7l-1-7z"/><path d="M9 17l-2 5M15 17l2 5"/></svg>
        </div>
        <div><div class="tip-cat-title">Body Composition</div><div class="tip-cat-sub">Lower body fat → higher score</div></div>
      </div>
      <div class="tip-cat-items">
        <div class="tip-cat-item"><div class="ti-num">1</div><div class="ti-text"><h5>Caloric Deficit (500 cal/day)</h5><p>A consistent 500 calorie daily deficit results in roughly 1 lb of fat loss per week. Use a food tracker for accuracy — most people underestimate by 30%.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">2</div><div class="ti-text"><h5>Lift Weights 3–4x/Week</h5><p>Resistance training preserves muscle during fat loss and improves body shape. Compound lifts (squat, bench, row, deadlift) give the most return per hour.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">3</div><div class="ti-text"><h5>1g Protein Per lb of Bodyweight</h5><p>High protein intake (0.8–1g/lb) keeps you full, preserves lean mass, and has the highest thermic effect of any macronutrient.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">4</div><div class="ti-text"><h5>10,000 Steps Daily</h5><p>Non-exercise activity thermogenesis (NEAT) is often more impactful than formal cardio. Walking 10k steps burns 300–500 extra calories without affecting recovery.</p></div></div>
      </div>
    </div>

    <div class="tip-cat">
      <div class="tip-cat-head">
        <div class="tip-cat-icon" style="background:var(--accent-dim)">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="2" x2="12" y2="22"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        </div>
        <div><div class="tip-cat-title">Jawline & Bone Structure</div><div class="tip-cat-sub">Sharpen your facial definition</div></div>
      </div>
      <div class="tip-cat-items">
        <div class="tip-cat-item"><div class="ti-num">1</div><div class="ti-text"><h5>Mewing</h5><p>Rest your tongue flat on the roof of your mouth all day. Consistent practice over months reshapes the palate and can sharpen the jawline.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">2</div><div class="ti-text"><h5>Hard Mastic Gum</h5><p>Chewing hard gum (mastic or falim) for 30–60 min daily exercises the masseter muscles for a more defined jaw.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">3</div><div class="ti-text"><h5>Reduce Sodium</h5><p>Excess sodium causes water retention and facial bloat. Keep intake under 1.5g/day to reveal underlying bone structure.</p></div></div>
      </div>
    </div>

    <div class="tip-cat">
      <div class="tip-cat-head">
        <div class="tip-cat-icon" style="background:rgba(245,166,35,0.12)">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--amber)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
        </div>
        <div><div class="tip-cat-title">Skin Quality</div><div class="tip-cat-sub">Achieve a clear, glowing complexion</div></div>
      </div>
      <div class="tip-cat-items">
        <div class="tip-cat-item"><div class="ti-num">1</div><div class="ti-text"><h5>Drink 3L+ Water Daily</h5><p>Hydration plumps skin, reduces puffiness, and dramatically improves luminosity within 2 weeks of consistency.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">2</div><div class="ti-text"><h5>Tretinoin (Retinol)</h5><p>Prescription tretinoin is the gold standard for skin cell turnover. Improves texture, tone, and collagen in 3–6 months.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">3</div><div class="ti-text"><h5>Daily SPF 50+</h5><p>UV damage is the #1 cause of premature aging and uneven tone. Apply every morning, even indoors near windows.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">4</div><div class="ti-text"><h5>Cut Sugar & Dairy</h5><p>Both spike insulin and trigger acne. A 30-day elimination often causes dramatic skin clearing.</p></div></div>
      </div>
    </div>

    <div class="tip-cat">
      <div class="tip-cat-head">
        <div class="tip-cat-icon" style="background:var(--red-dim)">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        </div>
        <div><div class="tip-cat-title">Facial Symmetry</div><div class="tip-cat-sub">Balance your features</div></div>
      </div>
      <div class="tip-cat-items">
        <div class="tip-cat-item"><div class="ti-num">1</div><div class="ti-text"><h5>Sleep on Your Back</h5><p>Stomach sleeping compresses one side of the face for 7+ hours per night. Back sleeping prevents asymmetry from developing further.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">2</div><div class="ti-text"><h5>Fix Chewing Side</h5><p>Most people chew on one side, which builds muscle unevenly. Consciously alternate sides to develop symmetrical masseter muscles.</p></div></div>
        <div class="tip-cat-item"><div class="ti-num">3</div><div class="ti-text"><h5>Correct Posture</h5><p>Forward head posture creates visual asymmetry and a weaker neck profile. Keep ears over shoulders, chin level.</p></div></div>
      </div>
    </div>

  </div>
  <nav class="nav" style="position:sticky;bottom:0">
    <div class="ni" onclick="navTo('home',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></div>
    <div class="ni" onclick="navTo('history',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span>History</span></div>
    <div class="ni active" onclick="navTo('tipsscreen',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg><span>Tips</span></div>
    <div class="ni" onclick="navTo('profile',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></div>
  </nav>
</div>

<!-- ════ PROFILE ════ -->
<div class="screen" id="profile">
  <div class="prof-head">
    <div class="prof-avatar-wrap" id="profAvatarWrap">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <img id="profAvatar" src="" alt="">
    </div>
    <div class="prof-name">My Profile</div>
    <div class="prof-since" id="profSince">Member since today</div>
  </div>

  <div class="prof-stats">
    <div class="pstat"><div class="psn" id="psTotalScans">0</div><div class="psl">Total Scans</div></div>
    <div class="pstat"><div class="psn" id="psBestScore">—</div><div class="psl">Best Score</div></div>
    <div class="pstat"><div class="psn" id="psAvgScore">—</div><div class="psl">Avg Score</div></div>
  </div>

  <div class="prof-section">
    <h3>Account</h3>
    <div class="prof-row" onclick="showToast('Coming in app version')">
      <div class="pr-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--text2)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
      <div class="pr-label">Edit Profile</div>
      <div class="pr-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
  </div>

  <div class="prof-section">
    <h3>Data</h3>
    <div class="prof-row" onclick="exportHistory()">
      <div class="pr-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--text2)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></div>
      <div class="pr-label">Export History</div>
      <div class="pr-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
    <div class="prof-row" onclick="clearHistory()">
      <div class="pr-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg></div>
      <div class="pr-label" style="color:var(--red)">Clear All History</div>
      <div class="pr-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
  </div>

  <div style="padding:0 22px 110px">
    <p style="font-size:11px;color:var(--text3);text-align:center;line-height:1.7">
      looksmax.ai v2.0 — For entertainment purposes.<br>
      AI analysis is not a substitute for professional advice.
    </p>
  </div>

  <nav class="nav" style="position:sticky;bottom:0">
    <div class="ni" onclick="navTo('home',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></div>
    <div class="ni" onclick="navTo('history',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span>History</span></div>
    <div class="ni" onclick="navTo('tipsscreen',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg><span>Tips</span></div>
    <div class="ni active" onclick="navTo('profile',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></div>
  </nav>
</div>

</div><!-- /scroller -->
</div><!-- /frame -->
</div><!-- /shell -->

<script>
// ─── STATE ───
let currentFaceImg = '';
let currentBodyImg = '';
let currentMode = 'face'; // 'face' | 'body'
let currentResult = null;
let scanHistory = [];
let faceAiDone = false;
let bodyAiDone = false;
let faceAiResponse = null;
let bodyAiResponse = null;

// ─── MODE SWITCHING ───
function setMode(mode) {
  currentMode = mode;
  currentBodyImg = '';
  document.getElementById('modeFaceBtn').classList.toggle('active', mode === 'face');
  document.getElementById('modeBodyBtn').classList.toggle('active', mode === 'body');
  document.getElementById('bodyUploadZone').style.display = 'none';

  if (mode === 'face') {
    document.getElementById('uzTitle').textContent = 'Upload Face Photo';
    document.getElementById('uzDesc').textContent = 'Clear, well-lit selfie • Facing forward';
    document.getElementById('uzHint').textContent = 'Face Analysis';
    document.getElementById('uzHint').style.cssText = '';
  } else {
    document.getElementById('uzTitle').textContent = 'Upload Face Photo';
    document.getElementById('uzDesc').textContent = 'Step 1 of 2 — Clear selfie facing forward';
    document.getElementById('uzHint').textContent = 'Step 1 / 2 — Face';
    document.getElementById('uzHint').style.background = 'var(--blue-dim)';
    document.getElementById('uzHint').style.color = 'var(--blue)';
  }
}

function handleZoneClick() {
  document.getElementById('fileInput').click();
}

// ─── DRAG & DROP ───
const uz = document.getElementById('uploadZone');
uz.addEventListener('dragover', e => { e.preventDefault(); uz.classList.add('drag-over'); });
uz.addEventListener('dragleave', () => uz.classList.remove('drag-over'));
uz.addEventListener('drop', e => {
  e.preventDefault(); uz.classList.remove('drag-over');
  const f = e.dataTransfer.files[0];
  if (f && f.type.startsWith('image/')) loadFile(f, 'face');
});

// ─── NAVIGATION ───
function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({top:0,behavior:'instant'});
  document.getElementById('scroller').scrollTop = 0;
}
function navTo(id, el) {
  goTo(id);
  el.closest('.nav').querySelectorAll('.ni').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
}

// ─── FILE HANDLING ───
function handleFile(input, type) {
  const f = input.files[0]; if (!f) return;
  loadFile(f, type); input.value = '';
}
function loadFile(f, type) {
  const r = new FileReader();
  r.onload = e => {
    if (type === 'face') {
      currentFaceImg = e.target.result;
      if (currentMode === 'body') {
        // Show body upload prompt
        document.getElementById('bodyUploadZone').style.display = 'block';
        showToast('Face loaded! Now add a body photo.');
      } else {
        startAnalysis();
      }
    } else if (type === 'body') {
      currentBodyImg = e.target.result;
      startAnalysis();
    }
  };
  r.readAsDataURL(f);
}

// ─── ANALYSIS ───
function startAnalysis() {
  document.getElementById('scanImg').src = currentFaceImg;
  document.getElementById('resAvatar').src = currentFaceImg;
  document.getElementById('bodyUploadZone').style.display = 'none';

  // Reset UI
  document.getElementById('progFill').style.width = '0%';
  document.getElementById('scanPct').textContent = '0%';
  document.getElementById('resNum').textContent = '—';
  document.getElementById('resLabel').textContent = '—';
  document.getElementById('resCircle').style.strokeDashoffset = '314.2';
  document.getElementById('penaltyBanner').style.display = 'none';
  document.getElementById('scoreBreakdown').style.display = 'none';
  document.getElementById('bodyMetricsLabel').style.display = 'none';
  document.getElementById('bodyMetricsGrid').style.display = 'none';
  document.getElementById('fcContent').innerHTML = `<div class="fc-loading"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>Generating detailed feedback<span class="dots"><span>.</span><span>.</span><span>.</span></span></div>`;

  const isBodyMode = currentMode === 'body' && currentBodyImg;
  document.getElementById('scanTitle').textContent = isBodyMode ? 'Full Analysis' : 'Analyzing Your Face';

  // Build steps dynamically
  const stepsData = isBodyMode ? [
    { id:'s1', label:'Detecting facial landmarks' },
    { id:'s2', label:'Measuring symmetry ratios' },
    { id:'s3', label:'Evaluating skin quality' },
    { id:'s4', label:'Analyzing body composition' },
    { id:'s5', label:'Calculating body fat estimate' },
    { id:'s6', label:'Running AI model & scoring' },
  ] : [
    { id:'s1', label:'Detecting facial landmarks' },
    { id:'s2', label:'Measuring symmetry ratios' },
    { id:'s3', label:'Evaluating skin quality' },
    { id:'s4', label:'Running AI model' },
    { id:'s5', label:'Generating your score' },
  ];

  const stepsEl = document.getElementById('analysisSteps');
  stepsEl.innerHTML = '';
  stepsData.forEach(s => {
    const div = document.createElement('div');
    div.className = 'step'; div.id = s.id;
    div.innerHTML = `<div class="step-ic"><svg viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/></svg></div><p>${s.label}</p><div class="step-ck"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>`;
    stepsEl.appendChild(div);
  });

  goTo('analyzing');

  const pcts = isBodyMode
    ? [15, 30, 50, 65, 80, 100]
    : [20, 40, 60, 85, 100];
  const labels = isBodyMode
    ? ['Detecting facial landmarks...','Measuring symmetry ratios...','Evaluating skin quality...','Analyzing body composition...','Calculating body fat estimate...','Running AI model & scoring...']
    : ['Detecting facial landmarks...','Measuring symmetry ratios...','Evaluating skin quality...','Running AI model...','Generating your score...'];

  stepsData.forEach((s, i) => {
    setTimeout(() => {
      document.getElementById('scanStatus').textContent = labels[i];
      document.getElementById('progFill').style.width = pcts[i] + '%';
      document.getElementById('scanPct').textContent = pcts[i] + '%';
      document.getElementById(s.id).classList.add('done');
      if (i === stepsData.length - 1) setTimeout(buildResults, 600);
    }, 900 * (i + 1));
  });

  faceAiDone = false; bodyAiDone = false;
  faceAiResponse = null; bodyAiResponse = null;
  callFaceAI(currentFaceImg);
  if (isBodyMode) {
    callBodyAI(currentBodyImg);
  } else {
    bodyAiDone = true;
  }
}

// ─── FACE AI CALL ───
async function callFaceAI(imgData) {
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:1200,
        messages:[{
          role:'user',
          content:[
            { type:'image', source:{ type:'base64', media_type:'image/jpeg', data: imgData.split(',')[1] }},
            { type:'text', text:`You are a facial analysis AI for a looksmax app. Analyze this face carefully and respond ONLY with valid JSON, no markdown, no text outside the JSON.

Return EXACTLY this structure:
{
  "face_score": <integer 1-10>,
  "symmetry": <integer 1-10>,
  "jawline": <integer 1-10>,
  "skin": <integer 1-10>,
  "eyes": <integer 1-10>,
  "potential": <integer 1-10>,
  "facial_fat": <integer 1-10 where 10=very lean chiseled face, 5=average, 1=very puffy/round from excess fat>,
  "feedback": "<3-4 sentence honest facial assessment. Mention strongest features, areas for improvement. Be direct but constructive.>"
}

Score honestly. Most people score 4-7. Reserve 8-10 for exceptional cases. facial_fat reflects how much excess fat is visible on the face — round/puffy faces score lower.`
            }
          ]
        }]
      })
    });
    const data = await res.json();
    const txt = data.content?.[0]?.text || '';
    faceAiResponse = JSON.parse(txt.replace(/```json|```/g,'').trim());
  } catch(e) { faceAiResponse = null; }
  faceAiDone = true;
}

// ─── BODY AI CALL ───
async function callBodyAI(imgData) {
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:800,
        messages:[{
          role:'user',
          content:[
            { type:'image', source:{ type:'base64', media_type:'image/jpeg', data: imgData.split(',')[1] }},
            { type:'text', text:`You are a body composition analysis AI for a looksmax app. Analyze this body photo and respond ONLY with valid JSON.

Return EXACTLY this structure:
{
  "body_score": <integer 1-10 where 10=very lean athletic physique, 7=fit average, 5=average, 3=overweight, 1=severely obese>,
  "estimated_bf_pct": <estimated body fat percentage as integer, e.g. 15>,
  "bf_category": "<one of: Lean, Athletic, Average, Overweight, Obese>",
  "muscularity": <integer 1-10>,
  "posture": <integer 1-10>,
  "proportions": <integer 1-10>,
  "body_feedback": "<2-3 sentences on body composition, key observations, main areas to improve>"
}

Be honest. Excess body fat significantly impacts attractiveness. Average person is 5-6. Lean/muscular is 7-9. Obese is 2-3.`
            }
          ]
        }]
      })
    });
    const data = await res.json();
    const txt = data.content?.[0]?.text || '';
    bodyAiResponse = JSON.parse(txt.replace(/```json|```/g,'').trim());
  } catch(e) { bodyAiResponse = null; }
  bodyAiDone = true;
}

// ─── FALLBACKS ───
function getFaceFallback() {
  const seed = currentFaceImg.length % 89;
  const r = (min, max, off) => Math.min(max, Math.max(min, ((seed*37+off*23) % (max-min+1)) + min));
  const fs = r(4,8,1);
  return {
    face_score:fs, symmetry:r(3,9,2), jawline:r(3,9,3),
    skin:r(4,9,4), eyes:r(4,9,5), potential:r(Math.max(fs,5),10,6),
    facial_fat:r(4,8,7),
    feedback:`The facial structure shows ${fs>=7?'strong':fs>=5?'moderate':'developing'} features overall. ${fs>=7?'The bone structure and facial harmony are notable strengths.':'There is meaningful upside potential with targeted improvements.'} Skin quality and jawline definition would yield the most noticeable improvements. Consistent sleep, hydration, and a skincare routine are the highest-leverage changes to make.`
  };
}
function getBodyFallback() {
  const seed = (currentBodyImg||currentFaceImg).length % 73;
  const bs = Math.min(8, Math.max(3, ((seed*41+17) % 6) + 3));
  const bfCats = ['Lean','Athletic','Average','Overweight','Obese'];
  const bfMap = {9:'Lean',8:'Athletic',7:'Athletic',6:'Average',5:'Average',4:'Overweight',3:'Overweight',2:'Obese',1:'Obese'};
  const bfPct = {9:10,8:13,7:16,6:20,5:24,4:29,3:33,2:38,1:43};
  return {
    body_score:bs, estimated_bf_pct:bfPct[bs]||22,
    bf_category:bfMap[bs]||'Average',
    muscularity:Math.min(9,Math.max(2,bs)), posture:Math.min(8,Math.max(3,bs+1)),
    proportions:Math.min(8,Math.max(3,bs)),
    body_feedback:`Body composition analysis shows ${bs>=7?'a lean, well-proportioned physique':bs>=5?'an average build with room for improvement':'higher body fat levels that are affecting the overall appearance'}. ${bs<6?'Reducing body fat through diet and resistance training would significantly boost your overall score.':'Maintaining current conditioning while adding more muscle definition would elevate your score further.'}`
  };
}

// ─── BUILD RESULTS ───
function buildResults() {
  if (!faceAiDone || !bodyAiDone) { setTimeout(buildResults, 300); return; }

  const face = faceAiResponse || getFaceFallback();
  const body = (currentMode === 'body' && currentBodyImg) ? (bodyAiResponse || getBodyFallback()) : null;

  // ── SCORE CALCULATION ──
  // Face-only mode: use face_score, but apply facial_fat penalty
  // Body mode: weighted average (face 55%, body 45%), then apply bf penalty

  let facialFatPenalty = 0;
  if (face.facial_fat !== undefined) {
    // facial_fat: 10=lean, 1=puffy. If < 5, penalize
    if (face.facial_fat <= 3) facialFatPenalty = 1.5;
    else if (face.facial_fat <= 5) facialFatPenalty = 0.7;
    else if (face.facial_fat <= 7) facialFatPenalty = 0;
  }

  let faceScore = face.face_score;
  let bodyScore = body ? body.body_score : null;
  let finalScore, penaltyDesc = null;

  if (body) {
    // Body mode: weighted composite
    let raw = faceScore * 0.55 + bodyScore * 0.45;

    // Body fat penalty on top
    let bfPenalty = 0;
    const bf = body.body_score;
    if (bf <= 2) bfPenalty = 2.5;
    else if (bf <= 3) bfPenalty = 1.8;
    else if (bf <= 4) bfPenalty = 1.0;
    else if (bf <= 5) bfPenalty = 0.4;

    // Facial fat also contributes
    let totalPenalty = bfPenalty + facialFatPenalty * 0.3;
    finalScore = Math.max(1, Math.min(10, Math.round((raw - totalPenalty) * 10) / 10));
    finalScore = Math.round(finalScore);

    if (totalPenalty > 0.3) {
      const bfCat = body.bf_category;
      const bfPct = body.estimated_bf_pct;
      if (bf <= 4) {
        penaltyDesc = `<strong>−${(totalPenalty).toFixed(1)} score penalty</strong> applied. Estimated body fat (~${bfPct}%, ${bfCat}) is significantly impacting your overall score. Losing fat would rapidly improve your rating.`;
      } else if (bf <= 5) {
        penaltyDesc = `<strong>Small penalty applied</strong> for above-average body fat (~${bfPct}%, ${bfCat}). Even modest fat loss would boost your overall score.`;
      }
    }
  } else {
    // Face-only: just face score with small facial fat deduction
    finalScore = Math.max(1, Math.min(10, Math.round(faceScore - facialFatPenalty)));
    if (facialFatPenalty > 0.5) {
      penaltyDesc = `<strong>Facial fullness detected.</strong> Excess facial fat is affecting jawline definition and your score. Add body photos for full body fat analysis.`;
    }
  }

  const result = {
    overall: finalScore,
    face_score: faceScore,
    body_score: bodyScore,
    mode: body ? 'body' : 'face',
    symmetry: face.symmetry,
    jawline: face.jawline,
    skin: face.skin,
    eyes: face.eyes,
    potential: face.potential,
    facial_fat: face.facial_fat,
    feedback: face.feedback + (body ? '\n\n' + body.body_feedback : ''),
    body: body,
    penaltyDesc
  };

  currentResult = result;
  renderResults(result);
}

// ─── RATING HELPER ───
function getRating(s) {
  if (s >= 9) return {label:'Exceptional', color:'var(--accent)'};
  if (s >= 8) return {label:'Very Attractive', color:'var(--accent)'};
  if (s >= 7) return {label:'Attractive', color:'var(--accent)'};
  if (s >= 6) return {label:'Above Average', color:'var(--amber)'};
  if (s >= 5) return {label:'Average', color:'var(--amber)'};
  if (s >= 4) return {label:'Below Average', color:'var(--red)'};
  return {label:'Needs Improvement', color:'var(--red)'};
}
function badge(s){ return s>=7?'b-g':s>=5?'b-a':'b-r' }
function badgeLbl(s){ return s>=7?'Good':s>=5?'Fair':'Low' }
function barClr(s){ return s>=7?'var(--accent)':s>=5?'var(--amber)':'var(--red)' }
function bodyBadge(s){ return s>=7?'b-g':s>=5?'b-b':'b-r' }
function bodyBarClr(s){ return s>=7?'var(--accent)':s>=5?'var(--blue)':'var(--red)' }

function renderResults(d) {
  const rt = getRating(d.overall);
  document.getElementById('resNum').textContent = d.overall;
  document.getElementById('resLabel').textContent = rt.label;
  document.getElementById('resLabel').style.color = rt.color;
  document.getElementById('resCircle').style.stroke = rt.color;
  setTimeout(() => {
    document.getElementById('resCircle').style.strokeDashoffset = 314.2 - (d.overall/10)*314.2;
  }, 100);

  // Penalty banner
  const pb = document.getElementById('penaltyBanner');
  if (d.penaltyDesc) {
    document.getElementById('penaltyText').innerHTML = d.penaltyDesc;
    pb.style.display = 'flex';
  } else {
    pb.style.display = 'none';
  }

  // Score breakdown (body mode)
  if (d.mode === 'body') {
    document.getElementById('scoreBreakdown').style.display = 'flex';
    document.getElementById('sbdFace').textContent = d.face_score + '/10';
    document.getElementById('sbdFace').style.color = getRating(d.face_score).color;
    document.getElementById('sbdBody').textContent = d.body_score + '/10';
    document.getElementById('sbdBody').style.color = getRating(d.body_score).color;
    document.getElementById('sbdFinal').textContent = d.overall + '/10';
    document.getElementById('sbdFinal').style.color = rt.color;
  }

  // Feedback
  document.getElementById('fcContent').innerHTML = `<div class="fc-text">${d.feedback}</div>`;

  // Face Metrics
  const faceMets = [
    {label:'Face Score', score:d.face_score},
    {label:'Symmetry', score:d.symmetry},
    {label:'Jawline', score:d.jawline},
    {label:'Skin Quality', score:d.skin},
    {label:'Eye Area', score:d.eyes},
    {label:'Facial Leanness', score:d.facial_fat},
  ];
  const grid = document.getElementById('metricsGrid');
  grid.innerHTML = '';
  faceMets.forEach(m => {
    const pct = (m.score/10)*100;
    const c = document.createElement('div'); c.className = 'mc';
    c.innerHTML = `<div class="mc-lbl">${m.label}</div>
      <div class="mc-val">${m.score}<span class="den">/ 10</span></div>
      <span class="mc-badge ${badge(m.score)}">${badgeLbl(m.score)}</span>
      <div class="mc-bar"><div class="mc-fill" data-p="${pct}" style="width:0%;background:${barClr(m.score)}"></div></div>`;
    grid.appendChild(c);
  });

  // Body Metrics (if available)
  const bodyGrid = document.getElementById('bodyMetricsGrid');
  bodyGrid.innerHTML = '';
  if (d.body) {
    document.getElementById('bodyMetricsLabel').style.display = 'block';
    bodyGrid.style.display = 'grid';
    const b = d.body;
    const bodyMets = [
      {label:'Body Score', score:b.body_score},
      {label:'Body Fat', score:b.body_score, extra:b.bf_category + ' (~' + b.estimated_bf_pct + '%)'},
      {label:'Muscularity', score:b.muscularity},
      {label:'Posture', score:b.posture},
      {label:'Proportions', score:b.proportions},
    ];
    bodyMets.forEach(m => {
      const pct = (m.score/10)*100;
      const c = document.createElement('div'); c.className = 'mc body-metric';
      c.innerHTML = `<div class="mc-lbl" style="color:var(--blue)">${m.label}</div>
        <div class="mc-val">${m.score}<span class="den">/ 10</span></div>
        ${m.extra ? `<span class="mc-badge b-b">${m.extra}</span>` : `<span class="mc-badge ${bodyBadge(m.score)}">${badgeLbl(m.score)}</span>`}
        <div class="mc-bar"><div class="mc-fill" data-p="${pct}" style="width:0%;background:${bodyBarClr(m.score)}"></div></div>`;
      bodyGrid.appendChild(c);
    });
  }

  setTimeout(() => document.querySelectorAll('.mc-fill').forEach(e => e.style.width = e.dataset.p + '%'), 150);

  // Tips
  const allTips = {
    'Face Score': {title:'Elevate Your Face Score', text:'Skincare fundamentals (SPF, cleanser, moisturizer) + 8 hrs sleep + hydration form the highest-ROI stack for face improvement.'},
    'Symmetry': {title:'Improve Symmetry', text:'Sleep on your back, chew evenly on both sides, and practice nasal breathing. These habits prevent asymmetry from worsening over time.'},
    'Jawline': {title:'Sharpen Your Jawline', text:'Mewing, cutting sodium, and losing excess body fat (especially facial fat) are the three most reliable methods for a more defined jaw.'},
    'Skin Quality': {title:'Upgrade Your Skin', text:'Start with cleanser, SPF, and moisturizer twice daily. Add tretinoin after 4 weeks of consistent basics for cell turnover.'},
    'Eye Area': {title:'Enhance Eye Area', text:'Dark circles are often caused by dehydration and poor sleep. 3L water daily + 8 hours sleep consistently is the first protocol.'},
    'Facial Leanness': {title:'Reduce Facial Fat', text:'Facial fat reduces with overall weight loss. A 500 calorie daily deficit + resistance training shrinks facial fullness in 4–8 weeks.'},
    'Body Score': {title:'Improve Body Score', text:'Resistance training 3–4x/week + 500 calorie deficit + 1g protein per lb bodyweight is the most proven fat loss stack.'},
    'Muscularity': {title:'Build Muscle', text:'Compound lifts (squat, bench, deadlift, row) 3x/week with progressive overload. Muscle adds shape and structure.'},
    'Body Fat': {title:'Reduce Body Fat', text:'A consistent 500-calorie daily deficit leads to ~1 lb of fat loss per week. Track food intake for accuracy — most people underestimate by 30%.'},
  };

  const ranked = [...faceMets, ...(d.body ? [{label:'Body Score',score:d.body.body_score},{label:'Body Fat',score:d.body.body_score}] : [])].sort((a,b) => a.score - b.score);
  const tw = document.getElementById('tipsWrap');
  while(tw.children.length > 1) tw.removeChild(tw.lastChild);
  const tipSvg = `<svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`;

  const seen = new Set();
  let tipCount = 0;
  for (const m of ranked) {
    if (tipCount >= 3) break;
    const t = allTips[m.label];
    if (!t || seen.has(t.title)) continue;
    seen.add(t.title);
    const div = document.createElement('div'); div.className = 'tip';
    div.innerHTML = `<div class="tip-ic">${tipSvg}</div><div><h4>${t.title}</h4><p>${t.text}</p></div>`;
    tw.appendChild(div);
    tipCount++;
  }

  saveToHistory(d);
  goTo('results');
}

// ─── HISTORY ───
function saveToHistory(d) {
  const entry = {
    id: Date.now(),
    date: new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),
    score: d.overall,
    label: getRating(d.overall).label,
    color: getRating(d.overall).color,
    thumb: currentFaceImg,
    mode: d.mode,
    data: d
  };
  scanHistory.unshift(entry);
  if (scanHistory.length > 50) scanHistory.pop();
  renderHistory();
  updateProfile();
}

function renderHistory() {
  document.getElementById('streakNum').textContent = scanHistory.length;
  const empty = '<div class="hist-empty">No scans yet. Upload your first photo to get started.</div>';
  const homeEl = document.getElementById('homeHistList');
  if (!scanHistory.length) { homeEl.innerHTML = empty; return; }
  homeEl.innerHTML = '';
  scanHistory.slice(0,3).forEach(e => homeEl.appendChild(makeHistItem(e)));
  const fullEl = document.getElementById('fullHistList');
  fullEl.innerHTML = '';
  if (!scanHistory.length) {
    fullEl.innerHTML = `<div class="hist-empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><p>Your scan history will appear here.</p></div>`;
  } else {
    scanHistory.forEach(e => fullEl.appendChild(makeHistItem(e)));
  }
}

function makeHistItem(e) {
  const div = document.createElement('div'); div.className = 'hist-item';
  div.onclick = () => replayResult(e);
  const modeLabel = e.mode === 'body' ? 'Body + Face' : 'Face Only';
  const modeClass = e.mode === 'body' ? 'body' : 'face';
  div.innerHTML = `
    <img class="hist-thumb" src="${e.thumb}" alt="">
    <div class="hist-info">
      <div class="hi-score" style="color:${e.color}">${e.score}/10</div>
      <div class="hi-label">${e.label}</div>
      <span class="hi-mode ${modeClass}">${modeLabel}</span>
    </div>
    <div class="hist-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>`;
  return div;
}

function replayResult(e) {
  currentFaceImg = e.thumb;
  currentResult = e.data;
  document.getElementById('resAvatar').src = e.thumb;
  document.getElementById('resNum').textContent = '—';
  document.getElementById('resCircle').style.strokeDashoffset = '314.2';
  renderResults(e.data);
}

function clearHistory() {
  if (!scanHistory.length) return;
  scanHistory = [];
  renderHistory();
  updateProfile();
  showToast('History cleared');
}

// ─── PROFILE ───
function updateProfile() {
  document.getElementById('psTotalScans').textContent = scanHistory.length;
  if (!scanHistory.length) {
    document.getElementById('psBestScore').textContent = '—';
    document.getElementById('psAvgScore').textContent = '—';
    return;
  }
  const scores = scanHistory.map(e => e.score);
  document.getElementById('psBestScore').textContent = Math.max(...scores);
  document.getElementById('psAvgScore').textContent = (scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(1);
  if (scanHistory[0]?.thumb) {
    const img = document.getElementById('profAvatar');
    img.src = scanHistory[0].thumb; img.style.display = 'block';
    document.getElementById('profAvatarWrap').querySelector('svg').style.display = 'none';
  }
}

// ─── SHARE ───
function openModal() { document.getElementById('shareModal').classList.add('open'); }
function closeModal() { document.getElementById('shareModal').classList.remove('open'); }
function shareAction(type) {
  closeModal();
  if (type === 'copy') {
    const txt = currentResult ? `My looksmax.ai score: ${currentResult.overall}/10 — ${getRating(currentResult.overall).label}` : 'Check out looksmax.ai';
    navigator.clipboard?.writeText(txt).then(()=>showToast('Copied to clipboard')).catch(()=>showToast('Copy failed'));
  } else if (type === 'native') {
    if (navigator.share) navigator.share({title:'looksmax.ai', text:currentResult?`My score: ${currentResult.overall}/10`:'looksmax.ai'}).catch(()=>{});
    else showToast('Sharing not supported on this browser');
  } else {
    showToast('Screenshot saved — available in full app');
  }
}

// ─── EXPORT ───
function exportHistory() {
  if (!scanHistory.length) { showToast('No history to export'); return; }
  const rows = [['Date','Score','Label','Mode']];
  scanHistory.forEach(e => rows.push([e.date, e.score, e.label, e.mode]));
  const csv = rows.map(r => r.join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = 'looksmax-history.csv'; a.click();
  showToast('History exported');
}

// ─── TOAST ───
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

document.getElementById('profSince').textContent = 'Member since ' + new Date().toLocaleDateString('en-US',{month:'long',year:'numeric'});
</script>
</body>
</html>